eXpandchi-Addchi-Fullsigma (XAF) for GW calculation of large interface system 
(The current codes are based on BerkeleyGW-1.2.0 package. We assume users are familiar with BerkeleyGW.)

1) eXanpdchi instruction (The expandchi method is general, not restricted to BGW.): 
Unit cell lattice: a1 a2; and its reciprocal lattice: b1 b2 
Super cell lattice: A1 = n1 * a1 + n2 * a2 
                    A2 = m1 * a1 + m2 * a2 
and reciprocal lattice: B1 = ( m2 * b1 - m1 * b2 )/(n1m2-n2m1) 
                        B2 = (-n2 * b1 + n1 * b2 )/(n1m2-n2m1) 
b1 = n1 * B1 + m1 * B2 
b2 = n2 * B1 + m2 * B2 
Any q point in reciprocal space: q = X1 * B1 + X2 * B2 = x1 * b1 + x2 * b2 
X1 = n1 * x1 + n2 * x2; x1 = ( m2 * X1 - n2 * X2 )/(n1m2-n2m1) 
X2 = m1 * x1 + m2 * x2; x2 = (-m1 * X1 + n1 * X2 )/(n1m2-n2m1)

If the q-mesh in super cell is pxqx1 with q0 shift (qx qy), the corresponding q-mesh in unit cell is generated by generalfindqmesh.f90: 
ifort generalfindqmesh.f90 -o generalfindqmesh.x 
./generalfindqmesh.x < in_findq > out_findq 
the input file in_findq contains: p q n1 n2 m1 m2 qx qy 
Output files: out_findq: unit cell q0 shift qlist: unit cell WFN q point list qlistshift: unit cell WFNq q point list

Calculate unit cell chimat and chi0mat (skip_epsilon flag in epsilon.inp) with qlist and unit cell q0 shift. Calculate super cell chimat and chi0mat on pxqx1 mesh, with minimum number of bands but the correct epsilon cutoff.

link or copy the unit cell chimat and chi0mat to chimat1x1 and chi0mat1x1 
link or copy the supercell chimat and chi0mat to chimat_exactmxm and chi0mat_exactmxm

ifort g2dx.f90 -o g2dx.x ./g2dx.x < in_g2dx > out_g2dx 
the input file in_g2dx contains: p q n1 n2 m1 m2 
Output files: chimat_expandmxm and chi0mat_expandmxm

2) Addchi instruction: 
ifort addchi0.f90 -o addchi0.x 
ifort addchi.f90 -o addchi.x

link or copy the chimat and chi0mat of layer1 to chimat_bn andaddchi chi0mat_bn 
link or copy the chimat and chi0mat of layer1(or the bilayer) to chimat_bnG and chi0mat_bnG 
link or copy the chimat and chi0mat of layer2 to chimat_G and chi0mat_G

./addchi0.x > out_addchi0 ./addchi.x < in_addchi > out_addchi

input file in_addchi: number of total q points in super cell 
output file: chimat_add, chi0mat_add
